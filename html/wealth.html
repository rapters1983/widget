<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
   <meta name="viewport" content="maximum-scale=0.5,minimum-scale=0.5,user-scalable=1,width=device-width,initial-scale=0.5"/>
  <meta content="yes" name="apple-mobile-web-app-capable" />
  <meta content="black" name="apple-mobile-web-app-status-bar-style" />
  <meta content="telephone=no" name="format-detection" />
  <link rel="stylesheet" href="../css/reset.css">
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/font-icon.css">
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/api.css">
  <title>充值记录</title>
</head>
<body>
<div class="wrap">
  <div class="record">
    <!-- top顶部 -->
    <div class="top-bar" id="header">
      <div class="top-bar-bd">
        <p class="title">
          <i class="icon-m icon-left" onclick="api.closeWin()"></i>
          <span id="btn-title">充值记录</span><span class="arrow arrow-bottom"></span>
        </p>
      </div>
      <div class="top-bar-line"></div>
    </div>
    <!-- top顶部 -->
  </div>
</div>
</body>
<script src="../script/api.js"></script>
<script src="../script/lib/jquery-2.1.1.min.js"></script>
<script>
  function fInitInfo() {
    function isEmptyObject(o){
      for(var n in o){
        return false;
      }
      return true;
    }
    var user = $api.getStorage('user');
    if(!isEmptyObject(user)) {
      fChangeStatus();
    } else{
      // 登陆
      api.openWin({
        name:'landing',
        url:'landing.html',
        bgColor:'#FFF',
        animation: {
          type: 'movein',
          subType: 'from_bottom',
          duration: 300
        }
      });
    }
  }
  function fChangeStatus() {
    var oRecord = $api.getStorage('oRecord');
    if(oRecord) {
      for(var i in oRecord) {
        if(oRecord[i].status) {
          $('#btn-title').html(oRecord[i].title);
        }
      }
    }
    api.execScript({
      frameName: 'wealth-con',
      script: 'fInitInfo();'
    });
  }
  apiready = function(){
    api.addEventListener({name:'viewappear'}, function(ret, err){
      fInitInfo();
    });

    // 存储我的钱包类型
    var oRecord = {
      charge: {
        title: '充值记录'
      , status: true
      }
    , giftuse: {
        title: '送礼记录'
      , status: false
      }
    };
    $api.setStorage('oRecord', oRecord);
    fInitInfo();

    // 将我的钱包分成3个frame:一个头部，一个列表区域，一个下拉框
    var width = api.winWidth;
    var height = api.winHeight;
    if(api.systemType === 'android') {
      height = height - 25;
    }
    var headPos = 64;
    var conheight = height - headPos;
    api.openFrame({
      name: 'wealth-con',
      url: './wealth-con.html',
      bounces: true,
      opaque: true,
      vScrollBarEnabled: false,
      rect: {
        x: 0,
        y: headPos,
        w: width,
        h: conheight
      }
    });

    $('#btn-title').on('click', function() {
      api.openFrame({
        name: 'wealth-top',
        url: './wealth-top.html',
        opaque: false,
        bounces: false,
        vScrollBarEnabled: false,
        hScrollBarEnabled: false,
        scaleEnabled: false,
        bgColor: 'rgba(0, 0, 0, 0)',
        rect: {
          x: 0,
          y: 0,
          w: width,
          h: height
        }
      });
    });
  };
</script>
</html>